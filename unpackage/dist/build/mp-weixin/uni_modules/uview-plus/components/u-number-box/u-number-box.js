"use strict";const t=require("./props.js"),i=require("../../libs/mixin/mpMixin.js"),e=require("../../libs/mixin/mixin.js"),s=require("../../libs/function/index.js"),n=require("../../../../common/vendor.js"),o={name:"u-number-box",mixins:[i.mpMixin,e.mixin,t.props],data:()=>({currentValue:"",longPressTimer:null}),watch:{watchChange(t){this.check()},modelValue:{handler:function(t,i){t!==this.currentValue&&(this.currentValue=this.format(this.modelValue))},immediate:!0}},computed:{getCursorSpacing(){return s.getPx(this.cursorSpacing)},buttonStyle(){return t=>{const i={backgroundColor:this.bgColor,height:s.addUnit(this.buttonSize),color:this.color};return this.isDisabled(t)&&(i.backgroundColor="#f7f8fa"),i}},inputStyle(){this.disabled||this.disabledInput;return{color:this.color,backgroundColor:this.bgColor,height:s.addUnit(this.buttonSize),width:s.addUnit(this.inputWidth)}},watchChange(){return[this.integer,this.decimalLength,this.min,this.max]},isDisabled(){return t=>"plus"===t?this.disabled||this.disablePlus||this.currentValue>=this.max:this.disabled||this.disableMinus||this.currentValue<=this.min}},mounted(){this.init()},emits:["update:modelValue","focus","blur","overlimit","change","plus","minus"],methods:{init(){this.currentValue=this.format(this.modelValue)},format(t){return t=""===(t=this.filter(t))?0:+t,t=Math.max(Math.min(this.max,t),this.min),null!==this.decimalLength&&(t=t.toFixed(this.decimalLength)),t},filter(t){return t=String(t).replace(/[^0-9.-]/g,""),this.integer&&-1!==t.indexOf(".")&&(t=t.split(".")[0]),t},check(){const t=this.format(this.currentValue);t!==this.currentValue&&(this.currentValue=t,this.emitChange(t))},onFocus(t){this.$emit("focus",{...t.detail,name:this.name})},onBlur(t){this.format(t.detail.value),this.$emit("blur",{...t.detail,name:this.name})},onInput(t){const{value:i=""}=t.detail||{};if(""===i)return;let e=this.filter(i);if(null!==this.decimalLength&&-1!==e.indexOf(".")){const t=e.split(".");e=`${t[0]}.${t[1].slice(0,this.decimalLength)}`}return e=this.format(e),this.emitChange(e),e},emitChange(t){this.asyncChange||this.$nextTick((()=>{this.$emit("update:modelValue",t),this.currentValue=t,this.$forceUpdate()})),this.$emit("change",{value:t,name:this.name})},onChange(){const{type:t}=this;if(this.isDisabled(t))return this.$emit("overlimit",t);const i="minus"===t?-this.step:+this.step,e=this.format(this.add(+this.currentValue,i));this.emitChange(e),this.$emit(t)},add(t,i){const e=Math.pow(10,10);return Math.round((t+i)*e)/e},clickHandler(t){this.type=t,this.onChange()},longPressStep(){this.clearTimeout(),this.longPressTimer=setTimeout((()=>{this.onChange(),this.longPressStep()}),250)},onTouchStart(t){this.longPress&&(this.clearTimeout(),this.type=t,this.longPressTimer=setTimeout((()=>{this.onChange(),this.longPressStep()}),600))},onTouchEnd(){this.longPress&&this.clearTimeout()},clearTimeout(){clearTimeout(this.longPressTimer),this.longPressTimer=null}}};if(!Array){n.resolveComponent("u-icon")()}Math;const l=n._export_sfc(o,[["render",function(t,i,e,s,o,l){return n.e({a:t.showMinus&&t.$slots.minus},t.showMinus&&t.$slots.minus?{b:n.o((t=>l.clickHandler("minus"))),c:n.o((t=>l.onTouchStart("minus"))),d:n.o(((...t)=>l.clearTimeout&&l.clearTimeout(...t)))}:t.showMinus?{f:n.p({name:"minus",color:l.isDisabled("minus")?"#c8c9cc":"#323233",size:"15",bold:!0,customStyle:t.iconStyle}),g:n.o((t=>l.clickHandler("minus"))),h:n.o((t=>l.onTouchStart("minus"))),i:n.o(((...t)=>l.clearTimeout&&l.clearTimeout(...t))),j:l.isDisabled("minus")?1:"",k:n.s(l.buttonStyle("minus"))}:{},{e:t.showMinus,l:t.disabledInput||t.disabled,m:l.getCursorSpacing,n:t.disabled||t.disabledInput?1:"",o:o.currentValue,p:n.o(((...t)=>l.onBlur&&l.onBlur(...t))),q:n.o(((...t)=>l.onFocus&&l.onFocus(...t))),r:n.o(((...t)=>l.onInput&&l.onInput(...t))),s:n.s(l.inputStyle),t:t.showPlus&&t.$slots.plus},t.showPlus&&t.$slots.plus?{v:n.o((t=>l.clickHandler("plus"))),w:n.o((t=>l.onTouchStart("plus"))),x:n.o(((...t)=>l.clearTimeout&&l.clearTimeout(...t)))}:t.showPlus?{z:n.p({name:"plus",color:l.isDisabled("plus")?"#c8c9cc":"#323233",size:"15",bold:!0,customStyle:t.iconStyle}),A:n.o((t=>l.clickHandler("plus"))),B:n.o((t=>l.onTouchStart("plus"))),C:n.o(((...t)=>l.clearTimeout&&l.clearTimeout(...t))),D:l.isDisabled("plus")?1:"",E:n.s(l.buttonStyle("plus"))}:{},{y:t.showPlus})}],["__scopeId","data-v-2df33765"]]);wx.createComponent(l);
